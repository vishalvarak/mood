  function format_row($row)
    {
        $ur = $_SERVER['REQUEST_URI'];
        if (is_array($row)) {
            $row = (object) $row;
        }
        $formattedrow = array();
        $fl = 0;
        foreach (array_keys($this->columns) as $column) {
            $colmethodname = 'col_' . $column;
            if (method_exists($this, $colmethodname)) {
                $formattedcolumn = $this->$colmethodname($row);
            } else {
                $formattedcolumn = $this->other_cols($column, $row);
                if ($formattedcolumn === NULL) {
                    $formattedcolumn = $row->$column;
                }
            }
            $formattedrow[$column] = $formattedcolumn;
        }


        if (preg_match('/<div class="extensiondate">(.*?)<\/div>/', $formattedrow['status'], $matches)) {
            $extensionDateContent = $matches[1];
            preg_match('/id=(\d+)/', $formattedrow['fullname'], $matchess);

            if (isset($matchess[1])) {
                $idd = $matchess[1];

            } else {

            }

            preg_match('/id=(\d+)/', $formattedrow['grade'], $matchesss);

            if (isset($matchesss[1])) {
                $assignidd = $matchesss[1];

                global $DB;
                $sql = "SELECT a.name, a.course FROM mdl_assign a WHERE a.id = :id";
                $params = array('id' => $assignidd);

                $res = $DB->get_records_sql($sql, $params);
                foreach ($res as $record) {
                    $aname = $record->name;
                    $cid = $record->course;
                    // Now $name contains the name corresponding to the provided ID
                    // You can use $name as needed
                }

                $sqll = "SELECT c.fullname FROM mdl_course c WHERE c.id = :id";
                $paramss = array('id' => $cid);

                $ress = $DB->get_records_sql($sqll, $paramss);
                foreach ($ress as $record) {
                    $cname = $record->fullname;

                }

            } else {

            }

            $sqll = "SELECT u.firstname, u.username FROM mdl_user u WHERE u.id = :id";
            $paramss = array('id' => $idd);

            $ress = $DB->get_records_sql($sqll, $paramss);
            foreach ($ress as $record) {
                $fname = $record->firstname;
                $uname = $record->username;

            }


            $sqll = "SELECT u.firstname, u.lastname
            FROM mdl_course c
            JOIN mdl_context ctx ON c.id = ctx.instanceid
            JOIN mdl_role_assignments ra ON ctx.id = ra.contextid
            JOIN mdl_user u ON ra.userid = u.id
            JOIN mdl_role r ON ra.roleid = r.id
            WHERE c.id = :id
            AND r.shortname = 'editingteacher'";
            $paramss = array('id' => $cid);

            $ress = $DB->get_records_sql($sqll, $paramss);
            foreach ($ress as $record) {
                $tfname = $record->firstname;
                $tlname = $record->lastname;

            }

            $extensionDateContentt = 'Dear ' . $fname . '(' . $uname . '),<br><br>';
            $extensionDateContentt .= 'You have been granted an extension for the Assessment ' . $aname . ' for the course ' . $cname . '<br>';
            $extensionDateContentt .= 'The ';
            $extensionDateContentt .= $extensionDateContent . '<br><br><br><br> Regards<br> '.$tfname.' '.$tlname;

            $used = 2;

            $postsubject = 'Assessment due date extended for '.$aname.', '.$cname;
            $eventdata = new \core\message\message();
            $eventdata->component = 'mod_assign';    // the component sending the message. Along with name this must exist in the table message_providers
            $eventdata->name = 'assign_notification';        // type of message from that module (as module defines it). Along with component this must exist in the table message_providers
            $eventdata->userfrom = $used;      // user object
            $eventdata->userto = $idd;       // user object
            $eventdata->subject = $postsubject;   // very short one-line subject
            $eventdata->fullmessage = $extensionDateContentt;      // raw text
            $eventdata->fullmessageformat = FORMAT_PLAIN;   // text format
            $eventdata->fullmessagehtml = $extensionDateContentt;      // html rendered version
            $eventdata->smallmessage = '';             // useful for plugins like sms or twitter

            message_send($eventdata);




        } else {

        }

        return $formattedrow;
    }
